const _0x37d448=_0x390f;(function(_0x127d81,_0x48fd9b){const _0x31b8a1=_0x390f,_0x12b0e7=_0x127d81();while(!![]){try{const _0x558589=-parseInt(_0x31b8a1(0x1ef))/0x1*(parseInt(_0x31b8a1(0x1eb))/0x2)+parseInt(_0x31b8a1(0x1c9))/0x3*(parseInt(_0x31b8a1(0x1d7))/0x4)+-parseInt(_0x31b8a1(0x207))/0x5*(parseInt(_0x31b8a1(0x1d4))/0x6)+-parseInt(_0x31b8a1(0x202))/0x7+parseInt(_0x31b8a1(0x1fa))/0x8+-parseInt(_0x31b8a1(0x1e7))/0x9*(-parseInt(_0x31b8a1(0x1d2))/0xa)+parseInt(_0x31b8a1(0x1f1))/0xb;if(_0x558589===_0x48fd9b)break;else _0x12b0e7['push'](_0x12b0e7['shift']());}catch(_0x1d29be){_0x12b0e7['push'](_0x12b0e7['shift']());}}}(_0xb008,0x47208));let userID=_0x37d448(0x1f4);import{connect}from'cloudflare:sockets';const WS_READY_STATE_OPEN=0x1,WS_READY_STATE_CLOSING=0x2;export default{async 'fetch'(_0x418a89,_0x2cd25a,_0x4c200c){const _0x54633d=_0x37d448;try{userID=_0x2cd25a[_0x54633d(0x1ca)]||userID;const _0x1448ca=_0x418a89[_0x54633d(0x1c4)][_0x54633d(0x1f5)](_0x54633d(0x1e3));if(!_0x1448ca||_0x1448ca[_0x54633d(0x1ea)]()!=='websocket'){const _0x494200=new URL(_0x418a89['url']);if(_0x494200[_0x54633d(0x1cd)]==='/')return new Response('Not\x20Found',{'status':0x194,'statusText':_0x54633d(0x1e9)});if(_0x494200[_0x54633d(0x1cd)]==='/'+userID){const _0x3c62c6=_0x418a89[_0x54633d(0x1c4)][_0x54633d(0x1f5)](_0x54633d(0x1cf)),_0x50cc95=_0x54633d(0x1de)+userID+'@'+_0x3c62c6+_0x54633d(0x218)+_0x3c62c6+_0x54633d(0x1f6)+_0x3c62c6+'&path=/#'+_0x3c62c6;return new Response(_0x50cc95,{'status':0xc8,'headers':{'Content-Type':'text/plain;charset=utf-8'}});}return new Response(_0x54633d(0x1e9),{'status':0x194});}return await handleVLESSWebSocket(_0x418a89);}catch(_0x3165ba){return new Response(_0x3165ba[_0x54633d(0x208)](),{'status':0x1f4});}}};async function handleVLESSWebSocket(_0x3619a6){const _0x15afc1=_0x37d448,_0x484228=new WebSocketPair(),[_0x2d3fe6,_0x7ec912]=Object['values'](_0x484228);_0x7ec912[_0x15afc1(0x215)]();const _0x3b55ae=_0x3619a6[_0x15afc1(0x1c4)][_0x15afc1(0x1f5)](_0x15afc1(0x1c5))||'',_0x17e251=createWebSocketReadableStream(_0x7ec912,_0x3b55ae);let _0x31ae51=null,_0x192357=null,_0x2f8b85=![];return _0x17e251[_0x15afc1(0x200)](new WritableStream({async 'write'(_0x64efd9){const _0xb9f1e3=_0x15afc1;if(_0x2f8b85&&_0x192357)return _0x192357(_0x64efd9);if(_0x31ae51){const _0x21dcbe=_0x31ae51[_0xb9f1e3(0x21c)]['getWriter']();await _0x21dcbe[_0xb9f1e3(0x20b)](_0x64efd9),_0x21dcbe[_0xb9f1e3(0x1fe)]();return;}const _0x6e725b=parseVLESSHeader(_0x64efd9,userID);if(_0x6e725b[_0xb9f1e3(0x216)])throw new Error(_0x6e725b['message']);const _0x221873=new Uint8Array([_0x6e725b[_0xb9f1e3(0x1dd)][0x0],0x0]),_0x2267f3=_0x64efd9[_0xb9f1e3(0x1e0)](_0x6e725b['rawDataIndex']);if(_0x6e725b[_0xb9f1e3(0x201)]){if(_0x6e725b['portRemote']===0x35){_0x2f8b85=!![];const {write:_0x3dd79e}=await handleUDPOutBound(_0x7ec912,_0x221873);_0x192357=_0x3dd79e,_0x192357(_0x2267f3);return;}else throw new Error(_0xb9f1e3(0x1ff));}async function _0x50d20b(_0x21e9de,_0x2d93a8){const _0x4d0b1f=_0xb9f1e3,_0x3dd639=await connect({'hostname':_0x21e9de,'port':_0x2d93a8});_0x31ae51=_0x3dd639;const _0x575f4a=_0x3dd639[_0x4d0b1f(0x21c)][_0x4d0b1f(0x1c8)]();return await _0x575f4a[_0x4d0b1f(0x20b)](_0x2267f3),_0x575f4a['releaseLock'](),_0x3dd639;}function _0x3014a9(_0x58a65e){const _0x3f3bfb=_0xb9f1e3,_0x2f7b49=_0x58a65e[_0x3f3bfb(0x1df)]('.');if(_0x2f7b49['length']!==0x4)throw new Error(_0x3f3bfb(0x21b));const _0x31d8f2=_0x2f7b49[_0x3f3bfb(0x20c)](_0x53e420=>{const _0x2e83be=_0x3f3bfb,_0x56b761=parseInt(_0x53e420,0xa);if(_0x56b761<0x0||_0x56b761>0xff)throw new Error(_0x2e83be(0x203));return _0x56b761[_0x2e83be(0x208)](0x10)[_0x2e83be(0x213)](0x2,'0');});return'[2001:67c:2960:6464::'+_0x31d8f2[0x0]+_0x31d8f2[0x1]+':'+_0x31d8f2[0x2]+_0x31d8f2[0x3]+']';}async function _0x59d6d1(_0x4cc22b){const _0x2d36fa=_0xb9f1e3;try{const _0x4db380=await fetch(_0x2d36fa(0x219)+_0x4cc22b+'&type=A',{'headers':{'Accept':_0x2d36fa(0x209)}}),_0x309de8=await _0x4db380['json']();if(_0x309de8[_0x2d36fa(0x210)]&&_0x309de8[_0x2d36fa(0x210)][_0x2d36fa(0x1fd)]>0x0){const _0x3904e5=_0x309de8[_0x2d36fa(0x210)][_0x2d36fa(0x1ce)](_0x123c50=>_0x123c50['type']===0x1);if(_0x3904e5){const _0xab9462=_0x3904e5[_0x2d36fa(0x217)];return _0x3014a9(_0xab9462);}}throw new Error('无法解析域名的IPv4地址');}catch(_0x5dcb15){throw new Error(_0x2d36fa(0x1e5)+_0x5dcb15['message']);}}async function _0x173a6a(){const _0x2ec9ab=_0xb9f1e3;try{let _0x46c849;const _0x280e12=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;_0x280e12[_0x2ec9ab(0x1d1)](_0x6e725b['addressRemote'])?(_0x46c849=_0x3014a9(_0x6e725b[_0x2ec9ab(0x1d5)]),console[_0x2ec9ab(0x206)](_0x2ec9ab(0x1ec)+_0x46c849)):(_0x46c849=await _0x59d6d1(_0x6e725b[_0x2ec9ab(0x1d5)]),console['log'](_0x2ec9ab(0x1da)+_0x46c849));console[_0x2ec9ab(0x206)](_0x2ec9ab(0x1e6)+_0x46c849+_0x2ec9ab(0x1d9));const _0x12c9fa=await connect({'hostname':_0x46c849,'port':_0x6e725b['portRemote']});_0x31ae51=_0x12c9fa;const _0x86b4c=_0x12c9fa['writable']['getWriter']();await _0x86b4c[_0x2ec9ab(0x20b)](_0x2267f3),_0x86b4c[_0x2ec9ab(0x1fe)](),_0x12c9fa[_0x2ec9ab(0x214)]['catch'](_0xf9ff48=>{const _0x159479=_0x2ec9ab;console[_0x159479(0x21f)](_0x159479(0x20e),_0xf9ff48);})[_0x2ec9ab(0x1c6)](()=>{const _0x16d459=_0x2ec9ab;_0x7ec912[_0x16d459(0x1f3)]===WS_READY_STATE_OPEN&&_0x7ec912[_0x16d459(0x1f9)](0x3e8,_0x16d459(0x1f7));}),pipeRemoteToWebSocket(_0x12c9fa,_0x7ec912,_0x221873,null);}catch(_0x505429){console[_0x2ec9ab(0x21f)](_0x2ec9ab(0x205),_0x505429),_0x7ec912[_0x2ec9ab(0x1f9)](0x3f3,'NAT64\x20IPv6连接失败:\x20'+_0x505429[_0x2ec9ab(0x21e)]);}}try{const _0x5b673c=await _0x50d20b(_0x6e725b[_0xb9f1e3(0x1d5)],_0x6e725b[_0xb9f1e3(0x1e2)]);pipeRemoteToWebSocket(_0x5b673c,_0x7ec912,_0x221873,_0x173a6a);}catch(_0x3b7c39){console['error'](_0xb9f1e3(0x1fb),_0x3b7c39),_0x7ec912[_0xb9f1e3(0x1f9)](0x3f3,_0xb9f1e3(0x1e1));}},'close'(){_0x31ae51&&closeSocket(_0x31ae51);}}))[_0x15afc1(0x20d)](_0x2188d7=>{const _0x28584b=_0x15afc1;console[_0x28584b(0x21f)]('WebSocket\x20错误:',_0x2188d7),closeSocket(_0x31ae51),_0x7ec912[_0x28584b(0x1f9)](0x3f3,_0x28584b(0x1dc));}),new Response(null,{'status':0x65,'webSocket':_0x2d3fe6});}function createWebSocketReadableStream(_0x22038f,_0x26c96b){return new ReadableStream({'start'(_0x4f4a11){const _0x4c483b=_0x390f;_0x22038f[_0x4c483b(0x1d8)](_0x4c483b(0x21e),_0x5ed2a9=>{const _0x5a4ba1=_0x4c483b;_0x4f4a11['enqueue'](_0x5ed2a9[_0x5a4ba1(0x217)]);}),_0x22038f[_0x4c483b(0x1d8)](_0x4c483b(0x1f9),()=>{const _0x5ea212=_0x4c483b;_0x4f4a11[_0x5ea212(0x1f9)]();}),_0x22038f[_0x4c483b(0x1d8)](_0x4c483b(0x21f),_0x4b08ce=>{_0x4f4a11['error'](_0x4b08ce);});if(_0x26c96b)try{const _0x22a8a9=atob(_0x26c96b[_0x4c483b(0x222)](/-/g,'+')['replace'](/_/g,'/')),_0x3666f6=Uint8Array[_0x4c483b(0x1f0)](_0x22a8a9,_0x1f853e=>_0x1f853e[_0x4c483b(0x1d0)](0x0));_0x4f4a11[_0x4c483b(0x221)](_0x3666f6[_0x4c483b(0x220)]);}catch(_0x566c03){}}});}function parseVLESSHeader(_0x2f0180,_0x20f2cc){const _0x4bd963=_0x37d448;if(_0x2f0180[_0x4bd963(0x1f2)]<0x18)return{'hasError':!![],'message':_0x4bd963(0x212)};const _0x47b4e0=new DataView(_0x2f0180),_0x2d444b=new Uint8Array(_0x2f0180[_0x4bd963(0x1e0)](0x0,0x1)),_0x1279a0=formatUUID(new Uint8Array(_0x2f0180[_0x4bd963(0x1e0)](0x1,0x11)));if(_0x1279a0!==_0x20f2cc)return{'hasError':!![],'message':'无效的用户'};const _0x1edb92=_0x47b4e0['getUint8'](0x11),_0x26eb0b=_0x47b4e0[_0x4bd963(0x1fc)](0x12+_0x1edb92);let _0x12bd6f=![];if(_0x26eb0b===0x1){}else{if(_0x26eb0b===0x2)_0x12bd6f=!![];else return{'hasError':!![],'message':_0x4bd963(0x1cb)};}let _0x30b6aa=0x13+_0x1edb92;const _0x4d5692=_0x47b4e0['getUint16'](_0x30b6aa);_0x30b6aa+=0x2;const _0x1f0358=_0x47b4e0[_0x4bd963(0x1fc)](_0x30b6aa++);let _0x133f48='';switch(_0x1f0358){case 0x1:_0x133f48=Array[_0x4bd963(0x1f0)](new Uint8Array(_0x2f0180[_0x4bd963(0x1e0)](_0x30b6aa,_0x30b6aa+0x4)))[_0x4bd963(0x1db)]('.'),_0x30b6aa+=0x4;break;case 0x2:const _0x4f9023=_0x47b4e0['getUint8'](_0x30b6aa++);_0x133f48=new TextDecoder()[_0x4bd963(0x211)](_0x2f0180[_0x4bd963(0x1e0)](_0x30b6aa,_0x30b6aa+_0x4f9023)),_0x30b6aa+=_0x4f9023;break;case 0x3:const _0x33dac2=[];for(let _0x4a351a=0x0;_0x4a351a<0x8;_0x4a351a++){_0x33dac2[_0x4bd963(0x1cc)](_0x47b4e0[_0x4bd963(0x1ee)](_0x30b6aa)[_0x4bd963(0x208)](0x10)[_0x4bd963(0x213)](0x4,'0')),_0x30b6aa+=0x2;}_0x133f48=_0x33dac2[_0x4bd963(0x1db)](':')[_0x4bd963(0x222)](/(^|:)0+(\w)/g,_0x4bd963(0x1f8));break;default:return{'hasError':!![],'message':_0x4bd963(0x1d6)};}return{'hasError':![],'addressRemote':_0x133f48,'portRemote':_0x4d5692,'rawDataIndex':_0x30b6aa,'vlessVersion':_0x2d444b,'isUDP':_0x12bd6f};}function pipeRemoteToWebSocket(_0x111cba,_0x43690c,_0xdce15d,_0x3f415f=null){const _0x364db0=_0x37d448;let _0x2fc5b1=![],_0xfa5788=![];_0x111cba[_0x364db0(0x1c7)][_0x364db0(0x200)](new WritableStream({'write'(_0x34739c){const _0x435f6b=_0x364db0;_0xfa5788=!![];if(_0x43690c[_0x435f6b(0x1f3)]===WS_READY_STATE_OPEN){if(!_0x2fc5b1){const _0x50edb3=new Uint8Array(_0xdce15d[_0x435f6b(0x1f2)]+_0x34739c[_0x435f6b(0x1f2)]);_0x50edb3[_0x435f6b(0x20a)](new Uint8Array(_0xdce15d),0x0),_0x50edb3[_0x435f6b(0x20a)](new Uint8Array(_0x34739c),_0xdce15d[_0x435f6b(0x1f2)]),_0x43690c['send'](_0x50edb3[_0x435f6b(0x220)]),_0x2fc5b1=!![];}else _0x43690c[_0x435f6b(0x21a)](_0x34739c);}},'close'(){const _0x1dd181=_0x364db0;if(!_0xfa5788&&_0x3f415f){_0x3f415f();return;}_0x43690c['readyState']===WS_READY_STATE_OPEN&&_0x43690c['close'](0x3e8,_0x1dd181(0x20f));},'abort'(){closeSocket(_0x111cba);}}))['catch'](_0xae84e6=>{const _0x715dd1=_0x364db0;console['error'](_0x715dd1(0x1e4),_0xae84e6),closeSocket(_0x111cba),_0x43690c[_0x715dd1(0x1f3)]===WS_READY_STATE_OPEN&&_0x43690c[_0x715dd1(0x1f9)](0x3f3,_0x715dd1(0x21d));});}function _0x390f(_0x448aee,_0x42fe12){const _0xb00868=_0xb008();return _0x390f=function(_0x390fb9,_0x20750c){_0x390fb9=_0x390fb9-0x1c4;let _0x438974=_0xb00868[_0x390fb9];return _0x438974;},_0x390f(_0x448aee,_0x42fe12);}function _0xb008(){const _0x5dcc0f=['22428fTtEdt','https://1.1.1.1/dns-query','Not\x20Found','toLowerCase','2HqXdTk','直接访问IPv4地址，转换为NAT64\x20IPv6:\x20','DNS\x20UDP处理错误:','getUint16','410957hlXKJT','from','2815175yOLGkq','byteLength','readyState','d342d11e-d424-4583-b36e-524ab1f0afa4','get','&type=ws&host=','连接已关闭','$1$2','close','4471848kBxyAG','连接失败:','getUint8','length','releaseLock','UDP代理仅支持DNS(端口53)','pipeTo','isUDP','936110dWAeSk','无效的IPv4地址段','application/dns-message','NAT64\x20IPv6连接失败:','log','695755BZqwuB','toString','application/dns-json','set','write','map','catch','NAT64\x20IPv6连接关闭错误:','正常关闭','Answer','decode','无效的头部长度','padStart','closed','accept','hasError','data',':443?encryption=none&security=tls&sni=','https://1.1.1.1/dns-query?name=','send','无效的IPv4地址','writable','数据传输错误','message','error','buffer','enqueue','replace','headers','sec-websocket-protocol','finally','readable','getWriter','24492OBETYW','UUID','不支持的命令，仅支持TCP(01)和UDP(02)','push','pathname','find','Host','charCodeAt','test','250cPglHj','arrayBuffer','6zduwHp','addressRemote','不支持的地址类型','48jCKmVa','addEventListener','\x20连接...','域名解析后转换为NAT64\x20IPv6:\x20','join','内部错误','vlessVersion','vless://','split','slice','连接失败','portRemote','Upgrade','数据转发错误:','DNS解析失败:\x20','尝试通过NAT64\x20IPv6地址\x20'];_0xb008=function(){return _0x5dcc0f;};return _0xb008();}function closeSocket(_0x44ab38){const _0x3233ea=_0x37d448;if(_0x44ab38)try{_0x44ab38[_0x3233ea(0x1f9)]();}catch(_0x42cebf){}}function formatUUID(_0x300680){const _0x525291=_0x37d448,_0x3b61fb=Array[_0x525291(0x1f0)](_0x300680,_0x43cd87=>_0x43cd87[_0x525291(0x208)](0x10)['padStart'](0x2,'0'))[_0x525291(0x1db)]('');return _0x3b61fb['slice'](0x0,0x8)+'-'+_0x3b61fb[_0x525291(0x1e0)](0x8,0xc)+'-'+_0x3b61fb[_0x525291(0x1e0)](0xc,0x10)+'-'+_0x3b61fb[_0x525291(0x1e0)](0x10,0x14)+'-'+_0x3b61fb[_0x525291(0x1e0)](0x14);}async function handleUDPOutBound(_0x1f8b2d,_0x5835a6){const _0x2d6c29=_0x37d448;let _0x11a512=![];const _0x47c536=new TransformStream({'start'(_0x1703c9){},'transform'(_0xa54e28,_0x18d4ec){const _0x6ab9bf=_0x390f;for(let _0x1194c5=0x0;_0x1194c5<_0xa54e28[_0x6ab9bf(0x1f2)];){const _0x3a3a73=_0xa54e28[_0x6ab9bf(0x1e0)](_0x1194c5,_0x1194c5+0x2),_0x3c5fbb=new DataView(_0x3a3a73)[_0x6ab9bf(0x1ee)](0x0),_0x1f9f06=new Uint8Array(_0xa54e28[_0x6ab9bf(0x1e0)](_0x1194c5+0x2,_0x1194c5+0x2+_0x3c5fbb));_0x1194c5=_0x1194c5+0x2+_0x3c5fbb,_0x18d4ec[_0x6ab9bf(0x221)](_0x1f9f06);}},'flush'(_0x205b52){}});_0x47c536[_0x2d6c29(0x1c7)][_0x2d6c29(0x200)](new WritableStream({async 'write'(_0x40c701){const _0x236ab0=_0x2d6c29,_0x46d572=await fetch(_0x236ab0(0x1e8),{'method':'POST','headers':{'content-type':_0x236ab0(0x204)},'body':_0x40c701}),_0x22a03f=await _0x46d572[_0x236ab0(0x1d3)](),_0x4bdf24=_0x22a03f['byteLength'],_0x492d22=new Uint8Array([_0x4bdf24>>0x8&0xff,_0x4bdf24&0xff]);_0x1f8b2d[_0x236ab0(0x1f3)]===WS_READY_STATE_OPEN&&(console[_0x236ab0(0x206)]('DNS查询成功，DNS消息长度为\x20'+_0x4bdf24),_0x11a512?_0x1f8b2d[_0x236ab0(0x21a)](await new Blob([_0x492d22,_0x22a03f])[_0x236ab0(0x1d3)]()):(_0x1f8b2d[_0x236ab0(0x21a)](await new Blob([_0x5835a6,_0x492d22,_0x22a03f])[_0x236ab0(0x1d3)]()),_0x11a512=!![]));}}))[_0x2d6c29(0x20d)](_0x1314b7=>{const _0x6b66fc=_0x2d6c29;console[_0x6b66fc(0x21f)](_0x6b66fc(0x1ed),_0x1314b7);});const _0x42b5e7=_0x47c536[_0x2d6c29(0x21c)]['getWriter']();return{'write'(_0x530539){const _0x1df432=_0x2d6c29;_0x42b5e7[_0x1df432(0x20b)](_0x530539);}};}
